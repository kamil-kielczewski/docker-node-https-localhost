# Node.js service template via HTTPS - docker, mkcert

This is only template for node service working on HTTPS localhost

## Run

Run below command once or twice:

```
docker compsose up
```

Then you can open browser at: https://localhost

This will create folder: ```./cert/CA` with `rootCA.pem` certificate.

## Instruction for Mac Os

We need to add info to system (MacOS) that `./cert/CA/rootCA.pem` is trusted certificate - this will stop the browser from warning the user that the site is untrusted.

1. Open Keychain Access
   Open Finder, navigate to Applications > Utilities, and launch Keychain Access. You can also use Spotlight (Cmd + Space), type in Keychain Access, and press Enter.
2. Add the CA certificate to the system keychain
   In Keychain Access, select the system keychain (System) from the list on the left side.
   Drag the rootCA.pem file from the ./certs/CA/ location onto the list of certificates in Keychain Access, or use the File > Import Items... menu and locate the rootCA.pem file.
   After importing the certificate, it should appear on the list. Admin password may be required to approve the import.
3. Set the certificate as trusted
   Locate the newly imported CA certificate in Keychain Access. It should be marked as mkcert development CA.
   Double-click the certificate to open the details window.
   Expand the Trust section.
   In the When using this certificate section, select Always Trust.
   Close the certificate details window. The system may ask for the admin password to save the changes.
4. Restart the browser
   To ensure the changes to the trusted certificates are recognized by the Chrome browser, restart it.
5. Verify the page
   After optionally restarting the browser, visit your page running on https://localhost. It should now be considered trusted, without any warnings about the untrusted certificate.

If warnings still appear, ensure that the server is using certificates generated by mkcert and the CA has been correctly added to the system keychain and set as trusted.

## How it works?

`DockerfileCert` will generate certificates and refresh them using `mkcert`, in `./certs` directory which is shared and visible outside docker

- ./certs/localhost.crt
- ./certs/localhost.key
  and
- ./certs/CA/rootCA.key

`Dockerfile` contains example image with node.

`docker-compose.yaml` map ./certs into node container and run `server.js` (it is example) which use it.

# Code

Code created with [ChatGPT](https://chat.openai.com/) support in about 2h.
